<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<title>raziskovalci db</title>
</head>
<body>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	
	<div class="container list-group list-group-flush">
		<h1 class="list-group-item"><code>articles.json</code> spletni pregled</h1>
		<div class="list-group-item accordion accordion-flush" id="accordions"></div>
	</div>

	<script>
		const userAccordionId = 'accordions';

		fetch("../articles.json")
		.then((res) => {
			if(!res.ok){ return {}; }
			return res.json();
		})
		.then((data) => {
			data.forEach((user, index) => {
				//console.log(index, user)

				let interestsAccordionItem = `
						<div class="accordion-item">
							<button class="btn btn-primary accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#i${index}" aria-expanded="true" aria-controls="i${index}">
								Interest tags (${user.interestTags.length})
							</button>
							<div id="i${index}" class="accordion-collapse collapse" data-bs-parent="#nestedAccordions${index}">
								<div class="accordion-body">
									<ul class="list-group list-group-flush">
										${user.interestTags.map(tag => '<li class="list-group-item">' + tag + '</li>').join('')}
									</ul>
								</div>
							</div>
						</div>
				`;
				let articleAccordionItem = `
						<div class="accordion-item">
							<button class="btn btn-primary accordion-button collapsed position-relative" type="button" data-bs-toggle="collapse" data-bs-target="#a${index}" aria-expanded="true" aria-controls="a${index}">
								Articles (${user.articles.length})
							</button>
							<div id="a${index}" class="accordion-collapse collapse" data-bs-parent="#nestedAccordions${index}">
								<div class="accordion-body">
									<ul class="list-group list-group-flush">
										${user.articles.map(tmpArticle => '<li class="list-group-item">' + listArticle(tmpArticle) + '</li>').join('')}
									</ul>
								</div>
							</div>
						</div>
				`;
				let userAccordionItem = `
					<div class="accordion-item">
						<button class="btn btn-primary accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${index}" aria-expanded="false" aria-controls="${index}">
							${user.fullName}
						</button>
						<div id="${index}" class="accordion-collapse collapse" data-bs-parent="#${userAccordionId}">
							<div class="accordion-body">
								<div class="accordion" id="nestedAccordions${index}">
									<ul class="list-group list-group-flush">
										<li class="list-group-item">Researcher at <strong>${user.researchFacility}</strong></li>
										<li class="list-group-item"><a href="${user.profileUrl}" class="link-info">Full profile</a></li>
										<li class="list-group-item">${interestsAccordionItem}</li>
										<li class="list-group-item">${articleAccordionItem}</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				`;

				document.getElementById(userAccordionId).innerHTML += userAccordionItem;
			});
		})
		.catch((error) => {
			console.error("Error:", error); // Catching any other errors that might occur
		});

		function listArticle(articleObj) {
			return `
				<ul class="list-group">
					<li class="list-group-item">Title: <strong>${articleObj.title}</strong></li>
					<li class="list-group-item">Year: <strong>${articleObj.year}<strong></li>
					<li class="list-group-item"><a href="${articleObj.url}" class="link-info">Article page url</a></li>
				</ul>
			`;
		}
	</script>
</body>
</html>